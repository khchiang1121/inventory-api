# 🛠️ 開發日誌

## ✅ 進度紀錄

### 🔐 認證機制
- 實作基本 Token 認證功能（`CustomTokenAuthentication`）  
  ⏱️ 約 1 小時  
- 認證方式切換至 DRF 原生模式：  
  ⏱️ 約 1 小時  
  使用：
  ```python
  from rest_framework.authentication import TokenAuthentication
  ```
- 後續計劃切換至更安全的 [Knox 認證套件](https://github.com/jazzband/django-rest-knox)（見 TODO）

### 授權機制
- 實作 Object-level 權限
  ⏱️ 約 6 小時  
  https://blog.csdn.net/weixin_42134789/article/details/105963583
---

### 🔁 架構重構與框架切換
- 專案由 **Django Ninja** 改為 **Django REST Framework (DRF)**  
  ⏱️ 約 8 小時  
- 調整專案結構至 DRF 推薦格式（app in project）  
  ⏱️ 約 5 小時

---

### 📄 API 文件生成
- 使用 `drf-spectacular` 撰寫 OpenAPI 文件  
  ⏱️ 約 2 小時  
  功能包含：
  - 生成 Redoc 文件
  - 生成 Swagger 文件
  - 切換為離線模式展示文件  
  - API支援輸入token
  參考資料：https://www.cnblogs.com/liuyanhang/p/18523423
---

### 🧩 API 版本控制
- 研究並實作 API 版本切換機制  
  ⏱️ 約 3 小時  
  參考資料：[API版本切換 HackMD](https://hackmd.io/xBnP6u46S42A_aHC7WZelw)

---

### 🖼️ 靜態檔案與前端資源支援
- 完成 Production / Development 的靜態檔案設定  
  ⏱️ 約 1 小時  
  工具：`whitenoise`  
  參考：
  - [靜態檔案設定 HackMD](https://hackmd.io/EddWhYqBTs-RDeb1BoVnJA)
  - [23. whitenoise](https://ithelp.ithome.com.tw/articles/10242574)
  - [學會Gunicorn 只需要看這篇]https://ithelp.ithome.com.tw/articles/10342996
  - [Gunicorn和Uvicorn
](https://zhuanlan.zhihu.com/p/605971741)
- 增加 `favicon.ico` 支援，並產生圖標  
  ⏱️ 約 1 小時

### Bug
- 修復inconsistent results with an unordered object_list
  ⏱️ 約 0.5 小時
  ```
    site-packages/rest_framework/pagination.py:207: UnorderedObjectListWarning: Pagination may yield inconsistent results with an unordered object_list: <class 'inventory_api.api.models.Maintainer'> QuerySet.
      paginator = self.django_paginator_class(queryset, page_size)
    [29/Mar/2025 18:52:50] "GET //api/v1/maintainers/ HTTP/1.1" 200 2349
    ```
    ![image](https://hackmd.io/_uploads/Sy5TWTrakx.png)
    ![image](https://hackmd.io/_uploads/B1HCZpH6kg.png)

### 資料庫
- 更改維護者為django內建使用者
  ⏱️ 約 2 小時
  https://hackmd.io/20GR-Ew0TQOC9wwma7PA-A
  ![image](https://hackmd.io/_uploads/Hyd0hu86Jl.png)

---
## 🔗 常用開發介面連結

| 功能            | URL                                |
|-----------------|-------------------------------------|
| **pgAdmin**     | [http://localhost:5050/browser/](http://localhost:5050/browser/) |
| **Swagger UI**  | [http://localhost:8001/api/v1/docs/](http://localhost:8001/api/v1/docs/) |
| **Django Admin**| [http://localhost:8001/admin](http://localhost:8001/admin) |





🛠 Changelog
[Unreleased] / [vX.Y.Z] – 2025-03-31
- Fixed: 修正當 API URL 結尾未加 / 時，PATCH/PUT/DELETE 請求被重導向為 GET 的問題
    - 關閉 APPEND_SLASH 設定以避免自動補斜線
    - 設定 DRF router 使用 trailing_slash=False，使路由更符合 RESTful API 習慣
    - 改善跨端請求的穩定性，防止非預期的重導行為



加上PRPO brand model network 機房管理表





---
## 📝 TODO
- 認證機制改為使用 Knox：  
  🔗 [Knox Token 認證 GitHub](https://github.com/jazzband/django-rest-knox)
- 權限管理要per object Object-level 權限:
  https://django-guardian.readthedocs.io/en/stable/#
- 轉換到Object-level 權限時，還是要保留維護者欄位，因為一個產品可能有一個維護者，可是會有很多人可以編輯，這些可以編輯的人，不一定收屬於維護者
https://github.com/sehmaschine/django-grappelli